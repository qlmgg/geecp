{extend name='Common/index' /} {block name='content'}
<div class="card bg-white">
  <div class="card-header toolbar bg-light d-flex p-3">
    基本信息
  </div>
  <div class="card-body border-0 py-0">
    <div class="table-box px-3 pb-3">
      <form class="needs-validation" novalidate>
        <div class="form-group border-bottom pb-3 pt-3">
          <label for="name">网站名称:</label>
          <div class="col form-inline px-0">
            <input type="text" id="name" name="name" class="form-control form-control-sm col-2 mr-3" value="{$info?$info['name']:''}" autocomplete="off">
            <input type="hidden" name="id" value="{$info?$info['id']:''}">
          </div>
          <div class="valid-feedback">
            ok
          </div>
          <div class="invalid-feedback">
            请输入站点名称
          </div>
        </div>
        <div class="form-group border-bottom pb-3">
          <label for="email">联系邮箱:</label>
          <div class="col form-inline px-0">
            <input type="text" id="email" name="email" class="form-control form-control-sm col-2 mr-3" value="{$info?$info['email']:''}" autocomplete="off">

          </div>
          <div class="valid-feedback">
            ok
          </div>
          <div class="invalid-feedback">
            请输入联系邮箱名称
          </div>
        </div>
        <div class="form-group border-bottom pb-3">
          <label for="url">网站首页域名:</label>
          <div class="col form-inline px-0">
            <input type="text" id="url" name="url" class="form-control form-control-sm col-2 mr-3" value="{$info?$info['url']:''}" autocomplete="off">
            <small class="text-muted ">
              网站首页域名必须以 "http://"、"http://"、"//" 开头 例：https://www.baidu.com
            </small>
          </div>
          <div class="valid-feedback">
            ok
          </div>
          <div class="invalid-feedback">
            请输入网站网址
          </div>
        </div>
        <div class="form-group border-bottom pb-3">
          <label for="logo">Logo:</label>
          <div class="col form-inline px-0">
            <div class="mr-3">

              <input type="file" id="file" name="file" class="upfile d-block" data-rule=".jpg,.png,.gif" data-size="2"
                data-width="200px" data-height="50px" autocomplete="off"> {if $info}
              <img src="{$info['logo']}" style="width:200px;height: 50px;margin-top: 15px;" /> {/if}
              <input type="hidden" id="logo" name="logo" value="{$info?$info['logo']:''}" autocomplete="off">
            </div>
            <small class="text-muted ">
              请上传 ".jpg"、".png"、".gif" 并且大小不超过2M 的图片文件
            </small>
          </div>
          <div class="valid-feedback">
            ok
          </div>
        </div>
        <div class="form-group border-bottom pb-3">
          <label for="logo1">深色LOGO:</label>
          <div class="col form-inline px-0">
            <div class="mr-3">
              <input type="file" id="file" name="file" class="upfile d-block" data-rule=".jpg,.png,.gif" data-size="2"
                data-width="200px" data-height="50px" autocomplete="off"> {if $info}
              <img src="{$info['logo1']}" style="width:200px;height: 50px;margin-top: 15px;" /> {/if}
              <input type="hidden" id="logo1" name="logo1" value="{$info?$info['logo1']:''}" autocomplete="off">
            </div>
            <small class="text-muted ">
              请上传 ".jpg"、".png"、".gif" 并且大小不超过2M 的图片文件
            </small>
          </div>
          <div class="valid-feedback">
            ok
          </div>
        </div>
        <div class="form-group border-bottom pb-3">
          <label for="file">favicon:</label>
          <div class="col form-inline px-0">
            <div class="mr-3">
              <input type="file" id="file" name="file" class="upfile d-block" data-rule=".jpg,.png,.gif" data-size="2"
                data-width="200px" data-height="50px" autocomplete="off"> {if $info}
              <img src="{$info['favicon']}" style="width:50px;height: 50px;margin-top: 15px;" /> {/if}
              <input type="hidden" id="favicon" name="favicon" value="{$info?$info['favicon']:''}" autocomplete="off">
            </div>

            <small class="text-muted ">
              请上传 ".jpg"、".png"、".gif" 并且大小不超过2M 的图片文件
            </small>
          </div>
          <div class="valid-feedback">
            ok
          </div>
        </div>
        <div class="form-group border-bottom pb-3">
          <label for="description">网站描述:</label>
          <div class="col form-inline px-0">
            <input type="text" name="description" id="description" class="form-control form-control-sm col-3 mr-3"
              value="{$info?$info['description']:''}" />
          </div>
        </div>
        <div class="form-group border-bottom pb-3">
          <label for="keywords">SEO关键字:</label>
          <div class="col form-inline px-0">
            <input type="text" name="keywords" id="keywords" class="form-control form-control-sm col-3 mr-3"
              value="{$info?$info['keywords']:''}" />
          </div>
        </div>
        <div class="form-group border-bottom pb-3">
          <label for="icp">ICP备案:</label>
          <div class="col form-inline px-0">
            <input type="text" name="icp" id="icp" class="form-control form-control-sm col-3 mr-3"
              value="{$info?$info['icp']:''}" />
          </div>
        </div>
        <div class="form-group border-bottom pb-3">
          <label for="beian">网安备案:</label>
          <div class="col form-inline px-0">
            <input type="text" name="beian" id="beian" class="form-control form-control-sm col-3 mr-3"
              value="{$info?$info['beian']:''}" />
          </div>
        </div>
        <div class="form-group border-bottom pb-3">
          <label for="idc">IDC备案:</label>
          <div class="col form-inline px-0">
            <input type="text" name="idc" id="idc" class="form-control form-control-sm col-3 mr-3"
              value="{$info?$info['idc']:''}" />
          </div>
        </div>
        <div class="form-group border-bottom pb-3">
          <label for="isp">ISP备案:</label>
          <div class="col form-inline px-0">
            <input type="text" name="isp" id="isp" class="form-control form-control-sm col-3 mr-3"
              value="{$info?$info['isp']:''}" />
          </div>
        </div>
        <div class="form-group border-bottom pb-3">
          <label for="maintain">维护模式:</label>
          <div class="col form-inline px-0">
            <div class="col-6 form-control-sm switch-box">
              <input type="checkbox" name="maintain" id="maintain" data-mid="maintain"
              value="{$info?$info['maintain']:'0'}" {$info?$info['maintain']=='1'
                ?'checked':'':''}>
              <label for="maintain" class="switch"></label>
            </div>
          </div>
        </div>
        <div class="form-group border-bottom pb-3">
          <label for="maintaininfo">维护展示内容:</label>
          <div class="col form-inline px-0">
            <input type="text" name="maintaininfo" id="maintaininfo" class="form-control form-control-sm col-3 mr-3"
              value="{$info?$info['maintaininfo']:''}" />
          </div>
        </div>
        <div class="form-group border-bottom pb-3">
          <label for="certification">强制开启实名认证:</label>
          <div class="col form-inline px-0">
            <div class="col-6 form-control-sm switch-box">
              <input type="checkbox" name="certification" id="certification" data-mid="certification" value="{:config('geecp.certification')}" {:config('geecp.certification')==true ?'checked':''}>
              <label for="certification" class="switch"></label>
            </div>
            <!-- <input type="text" name="certification" id="certification" class="form-control form-control-sm col-3 mr-3"
              value="{:config('geecp.certification')}" /> -->
          </div>
        </div>
        <div class="form-group border-bottom pb-3">
          <label for="code">第三方统计代码:</label>
          <div class="col form-inline px-0">
            <textarea type="text" name="code" id="code"
              class="form-control form-control-sm col-3 mr-3">{$info?$info['code']:''}</textarea>
          </div>
        </div>
        <div class="form-group border-bottom pb-3">
          <label for="account_name">开户名称(线下汇款用):</label>
          <div class="col form-inline px-0">
            <input type="text" id="account_name" name="account_name" class="form-control form-control-sm col-3 mr-3"
              value="{$info?$info['account_name']:''}" />
          </div>
        </div>
        <div class="form-group border-bottom pb-3">
          <label for="bank_name">开户银行(线下汇款用):</label>
          <div class="col form-inline px-0">
            <input type="text" id="bank_name" name="bank_name" class="form-control form-control-sm col-3 mr-3"
              value="{$info?$info['bank_name']:''}" />
          </div>
        </div>
        <div class="form-group border-bottom pb-3">
          <label for="account_number">汇款账号(线下汇款用):</label>
          <div class="col form-inline px-0">
            <input type="text" id="account_number" name="account_number" class="form-control form-control-sm col-3 mr-3"
              value="{$info?$info['account_number']:''}" />
          </div>
        </div>
        <div class="form-group border-bottom pb-3">
          <label for="account_number">支付宝商户ID:</label>
          <div class="col form-inline px-0">
            <input type="text" id="alipay_app_id" name="alipay_app_id" class="form-control form-control-sm col-3 mr-3"
              value="{:config('alipay.app_id')}" />
          </div>
        </div>
        <div class="form-group border-bottom pb-3">
          <label for="account_number">支付宝商户私钥:</label>
          <div class="col form-inline px-0">
            <textarea type="text" id="alipay_merchant_private_key" name="alipay_merchant_private_key" class="form-control form-control-sm col-3 mr-3" rows="5">{:config('alipay.merchant_private_key')}</textarea>
          </div>
        </div>
        <div class="form-group border-bottom pb-3">
          <label for="account_number">支付宝商户公钥:</label>
          <div class="col form-inline px-0">
            <textarea type="text" id="alipay_alipay_public_key" name="alipay_alipay_public_key" class="form-control form-control-sm col-3 mr-3" rows="5">{:config('alipay.alipay_public_key')}</textarea>
          </div>
        </div>
        <div class="form-group border-bottom pb-3">
          <label for="file">微信公众号关注图:</label>
          <div class="col form-inline px-0">
            <div class="mr-3">
              <input type="file" id="file" name="file" class="upfile d-block" data-rule=".jpg,.png,.gif" data-size="2"
                data-width="200px" data-height="200px" autocomplete="off"> {if config('wxpay.img')}
              <img src="{:config('wxpay.img')}" style="width:200px;height: 200px;margin-top: 15px;" /> {/if}
              <input type="hidden" id="wxpay_img" name="wxpay_img" value="{:config('wxpay.img')?config('wxpay.img'):''}" autocomplete="off">
            </div>

            <small class="text-muted ">
              请上传 ".jpg"、".png"、".gif" 并且大小不超过2M 的图片文件
            </small>
          </div>
          <div class="valid-feedback">
            ok
          </div>
        </div>
        <div class="form-group border-bottom pb-3">
          <label for="account_number">微信公众号ID:</label>
          <div class="col form-inline px-0">
            <input type="text" id="wxpay_appid" name="wxpay_appid" class="form-control form-control-sm col-3 mr-3" value="{:config('wxpay.appid')}" />
          </div>
        </div>
        <div class="form-group border-bottom pb-3">
          <label for="account_number">微信商户号:</label>
          <div class="col form-inline px-0">
            <input type="text" id="wxpay_mchid" name="wxpay_mchid" class="form-control form-control-sm col-3 mr-3" value="{:config('wxpay.mchid')}" />
          </div>
        </div>
        <div class="form-group border-bottom pb-3">
          <label for="account_number">微信公众号私钥:</label>
          <div class="col form-inline px-0">
            <input type="text" id="wxpay_appsecret" name="wxpay_appsecret" class="form-control form-control-sm col-3 mr-3" value="{:config('wxpay.appsecret')}" />
          </div>
        </div>
        <div class="form-group border-bottom pb-3">
          <label for="account_number">微信商户支付秘钥:</label>
          <div class="col form-inline px-0">
            <input type="text" id="wxpay_key" name="wxpay_key" class="form-control form-control-sm col-3 mr-3" value="{:config('wxpay.key')}" />
          </div>
        </div>
        <div>
          <button type="button" class="btn btn-primary btn-sm px-5 sub"> 提交</button>
          <a href="javascript:history.go(-1);" class="btn btn-outline-secondary btn-sm px-5">返回</a>
        </div>
      </form>
    </div>
  </div>
</div>
{/block} {block name='js'}
<!-- <script src="__STATIC__/dist/js/formBasic.js"></script> -->
<script>
  $('.upfile').change(function () {
    let tfile = $(this),
      imgurl = '',
      formdatas = new FormData(),
      suffix = tfile[0].files[0].name.substr(tfile[0].files[0].name.lastIndexOf("."));
    if (tfile.data('rule').indexOf(suffix) < 0) {
      alert('文件类型不符合要求');
      return false;
    }
    if ((tfile[0].files[0].size / 1024 / 1024) >= Number(tfile.data('size'))) {
      alert('图片尺寸大于2M');
      return false;
    }
    formdatas.append('file', tfile[0].files[0]);
    ajax('/uploadImg', formdatas, 'post', true).then(e => {
      if (e.status == 200) {
        tfile.siblings('[name]').val(e.data);
        if (tfile.next().prop('nodeName') == 'IMG') {
          tfile.next().attr('src', e.data);
          return;
        }
        tfile.after(
          `<img src="${e.data}" style="width:${tfile.data('width')};height: ${tfile.data('height')};margin-top: 15px;"/>`
        );
        return;
      }
      alert(e.msg);
    });
  });
  $('.sub').click(function () {
    let names = document.querySelectorAll('.form-group [name]'),
      vals = {};
    names = [].slice.call(names);
    names.map((e) => {
      if($(e).attr('type') == 'checkbox'){
        vals[e.name] = $(e).is(':checked') ? 1:0
      } else {
        vals[e.name] = e.value;
      }
    });
    // console.log(vals)
    // return;
    ajax('{:url("manager/System/basicAuth")}', vals, 'post').then(e => {
      if (e.status === 200) {
        alert(e.msg);
        location.href = "{:url('manager/System/basic')}";
      } else {
        alert(e.msg);
      }
    });
  });
</script>
{/block}